# 11주차 상담내용 (11/11)

## 현황 보고

### 진행 상황

- RISC-V에서 x86 KVM VMM으로 전환 완료
- Real Mode 게스트 5개 정상 작동 (minimal, hello, counter, hctest, multiplication)
- Protected Mode 게스트 2개 추가 구현 (pmode_simple, pmode_test)
- 총 7개 게스트 프로그램 정상 작동 확인

### 구현된 기능

- KVM API를 이용한 VMM (C, 약 450줄)
- Hypercall 시스템 (HC_EXIT, HC_PUTCHAR, HC_PUTNUM, HC_NEWLINE)
- Real Mode 16비트 게스트 지원
- Protected Mode 32비트 게스트 지원
- GDT, IDT 기본 설정

## 기술 논의

### 인터럽트 처리

현재 인터럽트 디스크립터 테이블(IDT)이 기본 설정 상태(빈 상태)로 구현되어 있음.

**현 상황:**

- 인터럽트 없이도 정상 작동 (hypercall 기반 I/O만 사용)
- 키보드 입력 같은 인터럽트 기반 기능은 미지원

**앞으로의 필요성:**

- 더 복잡한 OS를 포팅하려면 인터럽트 처리 필수
- [1K OS](https://operating-system-in-1000-lines.vercel.app/en/) 같은 토이 OS는 인터럽트 처리를 포함

### 페이징 및 메모리

- 게스트 메모리: 간단한 청크 기반 관리 (4MB 연속 메모리)
- 페이징은 현재 불필요 (단순 게스트와 토이 OS용)

## 다음 주(Week 12) 계획

### 1차 목표: 멀티 게스트 지원

- 여러 vCPU를 별도로 생성하여 동시 실행
- 예: 하나의 VMM에서 2-4개의 서로 다른 게스트 병렬 실행
- 구현: KVM_CREATE_VCPU를 여러 번 호출하고 각 게스트별로 초기화
- 데모: 화면을 나눠서 각 게스트의 출력을 동시에 표시

**예시 게스트 조합:**

- vCPU 1: multiplication.S (구구단)
- vCPU 2: counter.S (0-9 카운트)
- vCPU 3: hello.S ("Hello, KVM!")
- vCPU 4: hctest.S (hypercall 테스트)

### 2차 목표: 1K OS 포팅

- Rust로 작성된 x86 토이 OS를 VMM 위에서 실행
- 현재 어셈블리 게스트의 한계를 넘어 더 복잡한 기능 구현 가능
- 인터럽트 처리 예제 포함 (1K OS에 구현되어 있음)

**필요 작업:**

- 1K OS 소스 분석
- x86 KVM 환경에 맞게 부트로더 수정 (필요시)
- 게스트 메모리 레이아웃 조정

### 3차 목표: 성능 비교 분석

매트릭스 곱셈 또는 대규모 계산을 통해 성능 차이 측정:

**비교 대상:**

1. **KVM 모드 (현재):** 호스트 CPU 직접 사용
2. **QEMU 에뮬레이션 모드:** 호스트가 x86 명령어를 완전히 에뮬레이션

**측정 방식:**

- 10×10 또는 그 이상 크기의 매트릭스 곱셈 구현
- KVM과 에뮬레이션 모드 모두에서 실행
- 시간 측정 및 성능 비율 비교 (예: 10배, 100배 차이)
- 결과를 최종 발표 자료에 포함

## 최종 발표 자료 방향

### 구성

1. **개념 설명**

   - KVM과 에뮬레이션의 차이
   - 가상화 기법 개요

2. **구현 과정**

   - RISC-V 도구체인 문제 → x86으로 아키텍처 변경
   - 반복된 설계 재검토 (3-4회)
   - Real Mode → Protected Mode로의 발전

3. **성능 분석**

   - KVM vs 에뮬레이션 성능 비교
   - 벤치마크 결과 및 해석

4. **기술 시연**
   - 멀티 게스트 동시 실행 영상
   - 1K OS 부팅 및 실행 영상

## 요점 정리

### 교수 피드백

- "생각보다 빨리 진행됐다" - 1주일 만에 기초 완성
- "AI 도구 효과적" - 설정 및 복잡한 부분을 잘 처리함
- "멀티 게스트 지원은 상대적으로 쉽다" - KVM_CREATE_VCPU 여러 번 호출로 가능
- "1K OS는 포팅이 빨리 될 것으로 예상"

### 앞으로의 강점

- 이미 기본 VMM이 완성되어 있어 확장이 용이
- Protected Mode 지원으로 복잡한 OS 포팅 가능
- 문서와 코드가 잘 정리되어 있음

### 도전 과제

- 인터럽트 처리는 상대적으로 복잡
- 1K OS의 특정 기능이 x86 KVM에서 미지원될 가능성
- 성능 비교 시 동일한 환경에서의 측정 필요

## 다음 미팅 예정

- Week 12 중 (멀티 게스트 진행 상황 보고)
- 최종 발표 준비 상황 논의
