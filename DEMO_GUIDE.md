# ðŸŽ¬ Mini-KVM ì‹œì—° ê°€ì´ë“œ

ë°œí‘œ ì‹œ ì§ì ‘ ì‹œì—°í•  ìˆ˜ ìžˆëŠ” ì™„ì „í•œ ê°€ì´ë“œìž…ë‹ˆë‹¤.

---

## ðŸ“‹ ì‚¬ì „ ì¤€ë¹„

### 1. ë””ë ‰í† ë¦¬ ì´ë™
```bash
cd ~/ë¬¸ì„œ/ì½”ë“œ/mini-kvm/kvm-vmm-x86
```

### 2. ë¹Œë“œ í™•ì¸ (í•„ìš”ì‹œ)
```bash
# VMM ë¹Œë“œ
make vmm

# 1K OS ë¹Œë“œ í™•ì¸
cd os-1k && make && cd ..
```

---

## ðŸŽ¯ ì‹œì—° ì‹œë‚˜ë¦¬ì˜¤

### Demo 1: ê¸°ë³¸ Real Mode ê²ŒìŠ¤íŠ¸ë“¤

#### 1-1. Minimal Guest (ê°€ìž¥ ë‹¨ìˆœí•œ 1ë°”ì´íŠ¸ ê²ŒìŠ¤íŠ¸)
```bash
./kvm-vmm guest/minimal.bin
```
**ì„¤ëª…**: ë‹¨ 1ë°”ì´íŠ¸(HLT ëª…ë ¹ì–´)ë¡œ êµ¬ì„±ëœ ê°€ìž¥ ë‹¨ìˆœí•œ ê²ŒìŠ¤íŠ¸. VMMì´ ì •ìƒ ë™ìž‘í•˜ëŠ”ì§€ í™•ì¸.

**ì˜ˆìƒ ê²°ê³¼**: ì¦‰ì‹œ "Guest halted" ë©”ì‹œì§€ì™€ í•¨ê»˜ ì¢…ë£Œ

---

#### 1-2. Hello Guest (ë¬¸ìžì—´ ì¶œë ¥)
```bash
./kvm-vmm guest/hello.bin
```
**ì„¤ëª…**: "Hello, KVM!" ë©”ì‹œì§€ë¥¼ UART í¬íŠ¸(0x3f8)ë¡œ ì¶œë ¥í•˜ëŠ” 28ë°”ì´íŠ¸ ê²ŒìŠ¤íŠ¸.

**ì˜ˆìƒ ê²°ê³¼**: 
```
Hello, KVM!
```
ì¶œë ¥ í›„ ì¢…ë£Œ

---

#### 1-3. Counter Guest (ìˆ«ìž ì¶œë ¥)
```bash
./kvm-vmm guest/counter.bin
```
**ì„¤ëª…**: 0ë¶€í„° 9ê¹Œì§€ ìˆœì°¨ì ìœ¼ë¡œ ì¶œë ¥í•˜ëŠ” 18ë°”ì´íŠ¸ ê²ŒìŠ¤íŠ¸.

**ì˜ˆìƒ ê²°ê³¼**: 
```
0123456789
```
ì¶œë ¥ í›„ ì¢…ë£Œ

---

### Demo 2: ë©€í‹° vCPU (â˜… ê°€ìž¥ ì¸ìƒì !)

#### 2ê°œ ê²ŒìŠ¤íŠ¸ ë™ì‹œ ì‹¤í–‰
```bash
./kvm-vmm guest/multiplication.bin guest/counter.bin
```

**ì„¤ëª…**: 
- **vCPU 0**: Multiplication guestê°€ " x = " ì¶œë ¥ (hypercall ì‚¬ìš©)
- **vCPU 1**: Counter guestê°€ "0123456789" ì¶œë ¥ (UART ì‚¬ìš©)
- **í•µì‹¬**: ë‘ ì¶œë ¥ì´ ì¸í„°ë¦¬ë¸Œë˜ì–´ ë‚˜íƒ€ë‚¨ â†’ ì§„ì§œ ë³‘ë ¬ ì‹¤í–‰!

**ì˜ˆìƒ ê²°ê³¼**:
```
0 x 1 = 2 3 4 5 6 7 8 9
```
(ì¶œë ¥ì´ ì„žì—¬ì„œ ë‚˜ì˜´)

**ê°•ì¡° í¬ì¸íŠ¸**:
- ê° vCPUê°€ ë…ë¦½ì ì¸ 256KB ë©”ëª¨ë¦¬ ê³µê°„ ì‚¬ìš©
- vCPU 0: GPA 0x00000, vCPU 1: GPA 0x40000
- Real Modeì—ì„œ CS ë ˆì§€ìŠ¤í„°ë¡œ ì£¼ì†Œ ì§€ì • (CSÃ—16 + IP)

---

#### 4ê°œ ê²ŒìŠ¤íŠ¸ ë™ì‹œ ì‹¤í–‰ (ìµœëŒ€ í™•ìž¥ì„±)
```bash
./kvm-vmm guest/counter.bin guest/hello.bin guest/multiplication.bin guest/minimal.bin
```

**ì„¤ëª…**: 4ê°œ vCPUê°€ ê°ê° ë‹¤ë¥¸ í”„ë¡œê·¸ëž¨ì„ ë™ì‹œì— ì‹¤í–‰
- vCPU 0: Counter (0-9)
- vCPU 1: Hello
- vCPU 2: Multiplication
- vCPU 3: Minimal (ì¦‰ì‹œ ì¢…ë£Œ)

**ì˜ˆìƒ ê²°ê³¼**: 4ê°œ í”„ë¡œê·¸ëž¨ì˜ ì¶œë ¥ì´ ëª¨ë‘ ì„žì—¬ì„œ ë‚˜ì˜´

---

### Demo 3: 1K OS (Protected Mode with Paging)

#### 3-1. êµ¬êµ¬ë‹¨ ì¶œë ¥
```bash
# ìž…ë ¥ íŒŒì¼ ì¤€ë¹„
echo "1" > /tmp/demo_input.txt

# ì‹¤í–‰
./kvm-vmm --paging os-1k/kernel.bin < /tmp/demo_input.txt
```

**ì„¤ëª…**: 
- Protected Mode + íŽ˜ì´ì§• í™œì„±í™”
- 4MB ë©”ëª¨ë¦¬, GDT/IDT ì„¤ì •
- íƒ€ì´ë¨¸ & í‚¤ë³´ë“œ ì¸í„°ëŸ½íŠ¸ ì²˜ë¦¬
- User space í”„ë¡œê·¸ëž¨ ì‹¤í–‰

**ì˜ˆìƒ ê²°ê³¼**:
```
=== 1K OS Menu ===
  1. Multiplication (2x1 ~ 9x9)
  2. Counter (0-9)
  3. Echo (echo your input)
  4. About 1K OS
  0. Exit

Select: 1

=== Multiplication Table ===
2*1=2 2*2=4 2*3=6 ... 9*9=81
```

---

#### 3-2. ì¹´ìš´í„°
```bash
echo "2" > /tmp/demo_input.txt
./kvm-vmm --paging os-1k/kernel.bin < /tmp/demo_input.txt
```

**ì˜ˆìƒ ê²°ê³¼**:
```
=== Counter 0-9 ===
0 1 2 3 4 5 6 7 8 9
```

---

#### 3-3. ëŒ€í™”í˜• ì—ì½” (â˜… ë²„ê·¸ ìˆ˜ì • ì‹œì—°!)
```bash
printf "3\nHello World!\nThis is amazing!\nquit\n" > /tmp/demo_input.txt
./kvm-vmm --paging os-1k/kernel.bin < /tmp/demo_input.txt
```

**ì„¤ëª…**: 
- ì˜¤ëŠ˜ ìˆ˜ì •í•œ ë²„ê·¸ì˜ ê²°ê³¼ë¬¼!
- User spaceì—ì„œ OUT+IN hypercallë¡œ í‚¤ë³´ë“œ ìž…ë ¥ ë°›ê¸°
- IOPL=3 ì„¤ì •ìœ¼ë¡œ user space I/O í—ˆìš©

**ì˜ˆìƒ ê²°ê³¼**:
```
=== Echo Program (type 'quit' to exit) ===
$ 
Echo: 
$ 
Echo: Hello World!
$ 
Echo: This is amazing!
```

---

#### 3-4. About & Exit
```bash
printf "4\n0\n" > /tmp/demo_input.txt
./kvm-vmm --paging os-1k/kernel.bin < /tmp/demo_input.txt
```

**ì˜ˆìƒ ê²°ê³¼**:
```
=== About 1K OS ===
1K OS: Operating System in 1000 Lines
Ported from RISC-V to x86 Protected Mode
Features:
  - Protected Mode with Paging
  - Keyboard and Timer Interrupts
  - Simple Shell
  - File System (tar format)

Exiting shell...
```

---

## ðŸ’¡ ì‹œì—° íŒ

### 1. ì¶œë ¥ ì •ë¦¬
ë””ë²„ê·¸ ë©”ì‹œì§€ê°€ ë„ˆë¬´ ë§Žìœ¼ë©´:
```bash
./kvm-vmm guest/counter.bin 2>&1 | grep -v "IO\|EXIT\|HC"
```

### 2. íƒ€ìž„ì•„ì›ƒ ì„¤ì •
ë¬´í•œ ëŒ€ê¸° ë°©ì§€:
```bash
timeout 5s ./kvm-vmm --paging os-1k/kernel.bin < input.txt
```

### 3. ê¹”ë”í•œ í™”ë©´
ì‹œì—° ì „ì—:
```bash
clear
```

---

## ðŸŽ¤ ë°œí‘œ ìŠ¤í¬ë¦½íŠ¸ ì˜ˆì‹œ

### Demo 2 (ë©€í‹° vCPU) ì‹œì—° ì‹œ
```
"ì´ì œ ê°€ìž¥ ì¸ìƒì ì¸ ë¶€ë¶„ì¸ ë©€í‹° vCPUë¥¼ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
ë‘ ê°œì˜ ì™„ì „ížˆ ë…ë¦½ì ì¸ í”„ë¡œê·¸ëž¨ì´ ë™ì‹œì— ì‹¤í–‰ë©ë‹ˆë‹¤.

[ëª…ë ¹ì–´ ìž…ë ¥]

ë³´ì‹œë‹¤ì‹œí”¼ ë‘ í”„ë¡œê·¸ëž¨ì˜ ì¶œë ¥ì´ ì„žì—¬ ë‚˜ì˜¤ëŠ”ë°,
ì´ê²ƒì€ ì§„ì§œ ë³‘ë ¬ ì‹¤í–‰ì´ ì¼ì–´ë‚˜ê³  ìžˆë‹¤ëŠ” ì¦ê±°ìž…ë‹ˆë‹¤.

ê° vCPUëŠ” 256KBì˜ ë…ë¦½ì ì¸ ë©”ëª¨ë¦¬ ê³µê°„ì„ ê°€ì§€ê³  ìžˆìœ¼ë©°,
Real Modeì˜ ì„¸ê·¸ë¨¼íŠ¸ ì£¼ì†Œ ì§€ì • ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤."
```

### Demo 3-3 (ì—ì½”) ì‹œì—° ì‹œ
```
"ì´ ì—ì½” í”„ë¡œê·¸ëž¨ì€ íŠ¹ë³„í•œ ì˜ë¯¸ê°€ ìžˆìŠµë‹ˆë‹¤.
ì˜¤ëŠ˜ ë°œê²¬í•˜ê³  ìˆ˜ì •í•œ ë²„ê·¸ì˜ ê²°ê³¼ë¬¼ì´ê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤.

ë¬¸ì œëŠ” user spaceì˜ getchar í•¨ìˆ˜ê°€ OUT ëª…ë ¹ì–´ë§Œ ì‚¬ìš©í•´ì„œ
ìž…ë ¥ì„ ì „í˜€ ë°›ì§€ ëª»í–ˆë˜ ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.

ì´ë¥¼ OUT+IN í”„ë¡œí† ì½œë¡œ ìˆ˜ì •í•˜ê³ ,
IOPL=3ì„ ì„¤ì •í•´ì„œ user spaceì—ì„œ I/O ëª…ë ¹ì–´ë¥¼ 
ì‹¤í–‰í•  ìˆ˜ ìžˆê²Œ í–ˆìŠµë‹ˆë‹¤.

[ëª…ë ¹ì–´ ìž…ë ¥]

ì´ì œ ìž…ë ¥ì´ ì •ìƒì ìœ¼ë¡œ ì—ì½”ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìžˆìŠµë‹ˆë‹¤."
```

---

## ðŸ› ë¬¸ì œ í•´ê²°

### ë¬¸ì œ: "Permission denied" ë˜ëŠ” KVM ì ‘ê·¼ ë¶ˆê°€
```bash
# KVM ëª¨ë“ˆ í™•ì¸
lsmod | grep kvm

# ê¶Œí•œ í™•ì¸
ls -l /dev/kvm

# ê·¸ë£¹ ì¶”ê°€ (í•„ìš”ì‹œ)
sudo usermod -aG kvm $USER
```

### ë¬¸ì œ: ê²ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ ì•ˆ ë¨
```bash
# ìž¬ë¹Œë“œ
make clean
make
```

### ë¬¸ì œ: 1K OS ìž…ë ¥ ì•ˆ ë°›ìŒ
- íŒŒì¼ ë¦¬ë‹¤ì´ë ‰ì…˜ ì‚¬ìš©: `< input.txt`
- ì¶©ë¶„í•œ íƒ€ìž„ì•„ì›ƒ ì„¤ì •: `timeout 10s`

---

## ðŸ“Š í•µì‹¬ ìˆ˜ì¹˜

ë°œí‘œ ì‹œ ì–¸ê¸‰í•  ìˆ˜ ìžˆëŠ” í†µê³„:
- **ì½”ë“œ í¬ê¸°**: minimal 1ë°”ì´íŠ¸ ~ 1K OS 9,552ë°”ì´íŠ¸
- **ë©”ëª¨ë¦¬**: Real Mode 256KB, Protected Mode 4MB
- **ìµœëŒ€ vCPU**: 4ê°œ ë™ì‹œ ì‹¤í–‰
- **í•˜ì´í¼ì½œ ì¢…ë¥˜**: 3ê°€ì§€ (PUTCHAR, GETCHAR, EXIT)
- **VM exits**: ê°„ë‹¨í•œ ê²ŒìŠ¤íŠ¸ ~10íšŒ, 1K OS ~1000íšŒ

---

## âœ… ì‹œì—° ì²´í¬ë¦¬ìŠ¤íŠ¸

ì‹œì—° ì „ í™•ì¸:
- [ ] ë””ë ‰í† ë¦¬ ìœ„ì¹˜ í™•ì¸ (`kvm-vmm-x86`)
- [ ] ë¹Œë“œ ì™„ë£Œ í™•ì¸ (`./kvm-vmm` íŒŒì¼ ì¡´ìž¬)
- [ ] ê²ŒìŠ¤íŠ¸ ë°”ì´ë„ˆë¦¬ ì¡´ìž¬ í™•ì¸ (`ls guest/*.bin`)
- [ ] 1K OS ë¹Œë“œ í™•ì¸ (`os-1k/kernel.bin` ì¡´ìž¬)
- [ ] ìž…ë ¥ íŒŒì¼ ì¤€ë¹„ (`/tmp/demo_input.txt`)
- [ ] í„°ë¯¸ë„ í°íŠ¸ í¬ê¸° í™•ëŒ€ (ê°€ë…ì„±)
- [ ] í™”ë©´ ë…¹í™”/ìº¡ì²˜ ì¤€ë¹„ (ì„ íƒ)

---

**ì¤€ë¹„ ì™„ë£Œ! ì„±ê³µì ì¸ ë°œí‘œ ë˜ì‹œê¸¸ ë°”ëžë‹ˆë‹¤! ðŸš€**
