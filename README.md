# Mini-KVM: 교육용 x86 하이퍼바이저

> Linux KVM API를 사용하여 제작된 작지만 모든 기능이 동작하는 교육용 x86 하이퍼바이저입니다.

[![Project Status](https://img.shields.io/badge/status-complete-success)]()
[![Platform](https://img.shields.io/badge/platform-Linux%20x86__64-blue)]()
[![License](https://img.shields.io/badge/license-MIT-green)]()

**아주대학교 개인연구 프로젝트** (2025 가을)  
**작성자**: Seolcu  
**완료일**: 2025년 11월 22일

---

## 프로젝트 개요

Mini-KVM은 Linux KVM API를 사용하여 핵심 가상화 개념을 시연하는 교육용 하이퍼바이저입니다. 약 3,500줄의 C 코드로 이루어진 작은 크기에도 불구하고 다음과 같은 기능을 지원합니다.

- **다중 vCPU**: 최대 4개의 가상 CPU를 동시에 실행
- **리얼 모드 게스트**: 간단한 16비트 x86 프로그램 실행
- **보호 모드 및 페이징**: 32비트 운영체제 '1K OS' 완벽 지원
- **9개의 사용자 프로그램**: 수학/유틸리티 프로그램을 포함한 대화형 셸
- **네이티브에 가까운 성능**: 최소한의 가상화 오버헤드

이 프로젝트는 완전한 기능의 하이퍼바이저를 합리적인 시간 안에 처음부터 이해하고 구축할 수 있음을 증명합니다.

---

## 주요 기능

### VMM 핵심 기능
- **다중 vCPU 지원**: 최대 4개의 게스트 프로그램을 병렬로 실행
- **리얼 모드 (16비트)**: 레거시 x86 코드 직접 지원
- **보호 모드 (32비트)**: 세그멘테이션 및 페이징 완벽 지원
- **인터럽트 처리**: 타이머 및 키보드 인터럽트
- **하이퍼콜 인터페이스**: 효율적인 게스트-호스트 통신
- **I/O 에뮬레이션**: UART 시리얼 포트, 키보드 입력

### 게스트 운영체제
1. **리얼 모드 게스트** (6개 프로그램)
   - `minimal.bin`: 가장 간단한 1바이트 HLT 명령어 게스트
   - `hello.bin`: UART를 통해 "Hello, KVM!" 출력
   - `counter.bin`: 0부터 9까지 카운트
   - `multiplication.bin`: 하이퍼콜을 이용한 구구단 출력
   - `fibonacci.bin`: 피보나치 수열 생성기
   - `hctest.bin`: 하이퍼콜 테스트 모음

2. **1K OS** (보호 모드)
   - **9개의 대화형 프로그램**:
     1. 구구단 (2단 ~ 9단)
     2. 카운터 (0~9)
     3. 에코 (대화형 입출력)
     4. 피보나치 수열 (처음 15개 숫자)
     5. 소수 (100까지)
     6. 계산기 (+, -, *, /)
     7. 팩토리얼 (0! ~ 12!)
     8. 최대공약수 (유클리드 호제법)
     9. 1K OS 정보
   - GDT/IDT를 포함한 커널 공간
   - 시스템 콜을 통한 사용자 공간 프로그램
   - 하이퍼콜 기반 I/O
   - 타이머 인터럽트

---

## 빠른 시작

### 사전 요구사항
```bash
# Fedora/RHEL
sudo dnf install gcc make binutils qemu-kvm

# Ubuntu/Debian
sudo apt install gcc make binutils qemu-kvm

# KVM 지원 확인
lsmod | grep kvm
ls -l /dev/kvm
```

### VMM 및 게스트 빌드
```bash
# 저장소 복제
git clone https://github.com/seolcu/mini-kvm.git
cd mini-kvm/kvm-vmm-x86

# VMM 빌드
make vmm

# 게스트 프로그램 빌드
cd guest && ./build.sh && cd ..

# 1K OS 빌드
cd os-1k && make && cd ..
```

### 실행 예제

**1. 최소 기능 게스트 (1바이트)**
```bash
./kvm-vmm guest/minimal.bin
# 출력: 게스트가 즉시 멈춤 (Guest halts immediately)
```

**2. Hello World**
```bash
./kvm-vmm guest/hello.bin
# 출력: Hello, KVM!
```

**3. 다중 vCPU (2개 게스트 동시 실행)**
```bash
./kvm-vmm guest/multiplication.bin guest/counter.bin
# 출력: 진정한 병렬 실행을 보여주는 인터리빙된 출력
```

**4. 1K OS (보호 모드)**
```bash
# 구구단 프로그램 실행
printf "1\n0\n" | ./kvm-vmm --paging os-1k/kernel.bin

# 피보나치 수열 실행
printf "4\n0\n" | ./kvm-vmm --paging os-1k/kernel.bin

# 대화형 계산기 실행
printf "6\n12 + 5\n100 - 37\nq\n0\n" | ./kvm-vmm --paging os-1k/kernel.bin
```

---

## 아키텍처

### 시스템 개요
```
┌─────────────────────────────────────────────┐
│           사용자 공간 (호스트)              │
│  ┌───────────────────────────────────────┐  │
│  │  Mini-KVM VMM (main.c)                │  │
│  │  - VM 생성 및 관리                      │  │
│  │  - vCPU 스레드 (pthreads)               │  │
│  │  - I/O 처리 (UART, 하이퍼콜)            │  │
│  │  - 인터럽트 주입                        │  │
│  └───────────────────────────────────────┘  │
│              ↕ KVM ioctl()                   │
├─────────────────────────────────────────────┤
│           커널 공간 (호스트)                │
│  ┌───────────────────────────────────────┐  │
│  │  Linux KVM 모듈                       │  │
│  │  - 하드웨어 가상화 (Intel VT)           │  │
│  │  - VM exit 처리                       │  │
│  │  - 메모리 관리 (EPT)                    │  │
│  └───────────────────────────────────────┘  │
│              ↕ 하드웨어                      │
├─────────────────────────────────────────────┤
│           게스트 (가상 머신)                │
│  ┌───────────────────────────────────────┐  │
│  │  리얼 모드 게스트                     │  │
│  │  - 직접 x86 16비트 코드 실행          │  │
│  │  - UART I/O (port 0x3f8)              │  │
│  │  - 하이퍼콜 (port 0x500)                │  │
│  └───────────────────────────────────────┘  │
│                   또는                         │
│  ┌───────────────────────────────────────┐  │
│  │  1K OS (보호 모드)                    │  │
│  │  ┌─────────────────────────────────┐  │  │
│  │  │ 커널 공간                       │  │  │
│  │  │ - GDT/IDT                       │  │  │
│  │  │ - 페이징 (4MB 페이지)             │  │  │
│  │  │ - 인터럽트 핸들러                 │  │  │
│  │  └─────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────┐  │  │
│  │  │ 사용자 공간                     │  │  │
│  │  │ - 셸 (9개 프로그램)             │  │  │
│  │  │ - 하이퍼콜을 통한 시스템 콜     │  │  │
│  │  └─────────────────────────────────┘  │  │
│  └───────────────────────────────────────┘  │
└─────────────────────────────────────────────┘
```

---

## 프로젝트 구조

```
mini-kvm/
├── kvm-vmm-x86/              # 핵심 VMM 프로젝트 (C 기반)
│   ├── src/                  # VMM 소스코드
│   ├── guest/                # 리얼 모드 게스트 프로그램
│   └── os-1k/                # 1K OS (보호 모드 게스트)
├── docs/                     # 모든 문서
│   ├── 최종보고서.md
│   ├── 데모가이드.md
│   └── ...
├── experimental/             # 실험적/부가적 프로젝트
│   ├── hypervisor/           # [실험] Rust 기반 RISC-V 하이퍼바이저
│   ├── HLeOs/                # [실험] Rust 기반 64비트 OS
│   └── linux-guest/          # [실험] Linux 게스트 부팅 관련 파일
└── research/                 # 주간 연구 노트
```

---

## 문서

### 주요 문서
- **[README.md](README.md)** (현재 파일): 빠른 시작 및 프로젝트 개요
- **[최종보고서.md](docs/최종보고서.md)**: 포괄적인 프로젝트 보고서
- **[데모가이드.md](docs/데모가이드.md)**: 단계별 시연 가이드

### 연구 노트
- **[research/week1-12/](research/)**: 주간 진행 상황 보고서

---

## 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다. 자세한 내용은 [LICENSE](LICENSE) 파일을 참고하세요.
